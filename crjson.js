var crjson=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,o){"use strict";function n(e){return null===e?"null":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":Array.isArray(e)?"array":"object"==typeof e?"object":void 0}function r(e,t){const o={null:0,boolean:1,number:2,string:3,array:4,object:5},r=n(e),i=n(t);return r!=i?o[r]-o[i]:"boolean"==r||"number"==r?e-t:"string"==r?e>t?1:e<t?-1:0:0}function i(e,t){return void 0===e&&void 0===t?0:void 0===e&&void 0!==t?-1:void 0!==e&&void 0===t?1:e.userID!=t.userID?r(e.userID,t.userID):e.opID-t.opID}function s(e,t){for(let o=0;o<Math.max(e.length,t.length);o++){const n=e[o],r=t[o];if(void 0===n)return-1;if(void 0===r)return 1;if(n!=r)return n-r}return 0}function u(e,t){return e.filter(e=>0==i(e.parent,t))}function d(e){if(0!=e.length)return e.reduce((e,t)=>{if(t.counter>e.counter)return t;if(e.counter>t.counter)return e;const o=i(t.uid,e.uid);if(o>0)return t;if(o<0)return e;throw"Could not find ordering between objects"})}function c(e){const t=[];e.forEach(e=>{void 0!==e.index&&"array"==n(e.index)&&t.push(e.index)}),t.sort(s);const o=[];let r;return t.forEach(e=>{void 0!==r&&0==s(r,e)||o.push(e),r=e}),o}function l(e){const t={};return e.forEach(e=>{void 0!==e.index&&"string"==n(e.index)&&(void 0!==t[e.index]?t[e.index].push(e):t[e.index]=[e])}),t}function a(e){const t={};return e.forEach(e=>{if(void 0!==e.index&&"array"==n(e.index)){const o=e.index.toString();void 0!==t[o]?t[o].push(e):t[o]=[e]}}),t}function h(e,t){const o=[];for(const n in e){const r=t(e[n],n,e);void 0!==r&&o.push(r)}return o}function f(e,t){const o={};for(const n in e){const r=t(e[n],n,e);void 0!==r&&(o[n]=r)}return o}function p(e,t){const o=[];function r(t){const i=d(t);if(void 0===i)return;o.push(i);const s=n(i.value);return"array"==s?function(t){const o=u(e,t),n=a(o),i=c(o),s=f(n,r);return h(i,e=>s[e])}(i.uid):"object"==s?(p=i.uid,f(l(u(e,p)),r)):i.value;var p}return void 0===t&&(t=u(e,void 0)),{json:r(t),usefulData:o}}function v(e,t){return JSON.stringify(e)==JSON.stringify(t)}function _(e){return JSON.parse(JSON.stringify(e))}function m(e,t){return t.reduce((t,o)=>t||v(o,e),!1)}function g(e,t){let o,n;if(void 0!==e&&void 0!==t){o=e.slice(),n=t.slice();for(let o=0;o<e.length-t.length;o++)n.push(0);for(let n=0;n<t.length-e.length;n++)o.push(0)}else o=e,n=t;return function e(t,o,n,r){let i=0,s=Math.pow(2,n+4);if(void 0!==t&&void 0!==t[n]&&(i=Math.max(i,t[n])),void 0===o||void 0===o[n]||r||(s=Math.min(s,o[n])),i>s)throw`Backwards interval: (${t} ${o})`;if(i==s&&(void 0!==t&&n+1>=t.length||void 0!==o&&n+1>=o.length))throw`Empty interval: (${t} ${o})`;if(i+1>=s)return[i].concat(e(t,o,n+1,i<s));const u=i+1,d=Math.min(u+20,s);return[u+Math.floor(Math.random()*(d-u))]}(o,n,0,!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.betterTypeOf=n,t.compare=r,t.compareUIDs=i,t.compareVectorIndices=s,t.filterChildren=u,t.mergeAtoms=d,t.sortedVectorIndices=c,t.groupByStringIndex=l,t.groupByVectorIndex=a,t.arrayMap=h,t.objectMap=f,t.modelToJson=p,t.jsonEqual=v,t.jsonCopy=_,t.jsonInList=m,t.vectorIndexBetween=g;t.State=class{constructor(e){this._uid={userID:e,opID:0},this._model=[],this._json=null,this._tombstones=[],this._counter=0,this._listeners=[]}getUID(){const e={userID:this._uid.userID,opID:this._uid.opID};return this._uid.opID++,e}apply(e,t,o){if(0==e.length&&0==t.length)return;this._model.forEach(e=>{console.assert(!isNaN(e.counter),"Counter is NAN"),console.assert(void 0!==e.counter,"Counter is undefined")}),this._model.push(...e),this._tombstones.push(...t),this._counter=Math.max(this._counter,this._highestCounter(e)),this._model=this._model.filter(e=>!m(e.uid,this._tombstones));const n=p(this._model,void 0);this._json=void 0===n?null:n.json,this._model=this._model.filter(e=>n.usefulData.indexOf(e)>=0),o&&this._emit(e,t),this._changed(this._model,this._json)}emitCompleteState(){0!=this._model.length&&this._emit(this._model,this._tombstones)}state(){return{model:_(this._model),json:_(this._json)}}setState(e,t){const o=this._jsonDiff(e,t);this.apply(o.actions,o.tombstones,!0)}addListener(e){this._listeners.push(e)}removeListener(e){const t=this._listeners.indexOf(e);t>=0&&this._listeners.splice(t,1)}_changed(e,t){this._listeners.forEach(o=>{o(e,t)})}_emit(e,t){}_highestCounter(e){return e.reduce((e,t)=>t.counter>e?t.counter:e,-1)}_jsonDiff(e,t){const o=(t,_,m)=>{const x=d(_);if(void 0===x&&void 0===m)return;if(void 0===x&&void 0!==m)return void i.push(...r(m,t,void 0));if(void 0===m&&void 0!==x)return void s.push(x.uid);const b=n(x.value);if(b==n(m))return"array"==b?((t,n)=>{const s=u(e,t),d=a(s),l=c(s),_=f(d,t=>p(e,t).json),m=h(l,e=>void 0===_[e]?void 0:e),x=h(m,e=>_[e]),b=h(m,e=>d[e]),y={};y[[0,0].toString()]={cost:0};for(let e=1;e<=x.length;e++)y[[e,0].toString()]={cost:e,prev:[e-1,0],operation:"delete",oldIndex:e-1,newIndex:-1};for(let e=1;e<=n.length;e++)y[[0,e].toString()]={cost:e,prev:[0,e-1],operation:"insert",oldIndex:-1,newIndex:e-1};for(let e=1;e<=x.length;e++)for(let t=1;t<=n.length;t++){let o=1;v(x[e-1],n[t-1])&&(o=0);const r={cost:y[[e-1,t].toString()].cost+1,prev:[e-1,t],operation:"delete"},i={cost:y[[e,t-1].toString()].cost+1,prev:[e,t-1],operation:"insert"},s={cost:y[[e-1,t-1].toString()].cost+o,prev:[e-1,t-1]};o>0&&(s.operation="substitute");let u=s;i.cost<u.cost&&(u=i),r.cost<u.cost&&(u=r),u.oldIndex=e-1,u.newIndex=t-1,y[[e,t].toString()]=u}let I=y[[x.length,n.length].toString()];const j=[];for(;I.cost>0;)void 0!==I.operation&&(j[I.cost-1]=I),I=y[I.prev.toString()];let S,M;j.forEach(e=>{if("insert"==e.operation){let o=void 0;e.oldIndex==S?o=M:e.oldIndex>=0&&(o=m[e.oldIndex]);let s=void 0;e.oldIndex+1<m.length&&(s=m[e.oldIndex+1]);const u=g(o,s);i.push(...r(n[e.newIndex],t,u)),S=e.oldIndex,M=u}else"delete"==e.operation?o(t,b[e.oldIndex],void 0):"substitute"==e.operation&&o(t,b[e.oldIndex],n[e.newIndex])})})(x.uid,m):"object"==b?((t,n)=>{const s=l(u(e,t));for(const e in s)o(t,s[e],n[e]);for(const e in n)e in s||i.push(...r(n[e],t,e))})(x.uid,m):void(x.value==m||i.push(...r(m,t,x.index)));i.push(...r(m,t,x.index))},r=(e,t,o)=>{const r=[],i=(e,t,o)=>{const s=n(e);let u;u="array"==s?[]:"object"==s?{}:e;const d={uid:this.getUID(),value:u,counter:this._counter++};void 0!==t&&(d.parent=t),void 0!==o&&(d.index=o),r.push(d),"array"==s?((e,t)=>{let o=void 0;e.forEach(e=>{const n=g(o,void 0);i(e,t,n),o=n})})(e,d.uid):"object"==s&&((e,t)=>{for(const o in e)i(e[o],t,o)})(e,d.uid)};return i(e,t,o),r},i=[],s=[];return o(void 0,u(e,void 0),t),{actions:i,tombstones:s}}}},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),n(o(0)),n(o(2)),n(o(3))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);class r extends n.State{constructor(e){super(e),this._peers=[]}addPeer(e){this._peers.indexOf(e)<0&&e!==this&&(this._peers.push(e),e.addPeer(this),e.emitCompleteState())}removePeer(e){const t=this._peers.indexOf(e);t>=0&&(this._peers.splice(t,1),e.removePeer(this))}_emit(e,t){this._peers.forEach(o=>{o.apply(e,t)})}}t.LocalState=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);class r extends n.State{constructor(e){super(e),this._peers=[]}_sendMessage(e,t){let o=this._peers;void 0!==t&&(o=[t]),o.forEach(t=>{t.send(e)}),console.log("Model is:",this._model),console.log("TX:",e)}_requestCompleteState(e){this._sendMessage({action:"sendCompleteState"},e)}_receivedMessage(e){"sendCompleteState"==e.action?this.emitCompleteState():"update"==e.action&&this.apply(e.data,e.tombstones),console.log("RX:",e),console.log("Model is now:",this._model)}addPeer(e){this._peers.indexOf(e)<0&&(e.on("data",this._receivedMessage.bind(this)),this._peers.push(e),this._requestCompleteState(e))}removePeer(e){const t=this._peers.indexOf(e);t>=0&&this._peers.splice(t,1)}_emit(e,t){this._sendMessage({action:"update",data:e,tombstones:t})}}t.StateOverSimplePeer=r}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcmpzb24vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vY3Jqc29uLy4vc3JjL3N0YXRlLnRzIiwid2VicGFjazovL2NyanNvbi8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9jcmpzb24vLi9zcmMvbG9jYWwudHMiLCJ3ZWJwYWNrOi8vY3Jqc29uLy4vc3JjL3BlZXIudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJiZXR0ZXJUeXBlT2YiLCJpdGVtIiwiQXJyYXkiLCJpc0FycmF5IiwiY29tcGFyZSIsImZpcnN0Iiwic2Vjb25kIiwidHlwZU9yZGVyaW5nIiwidHlwZU9mRmlyc3QiLCJ0eXBlT2ZTZWNvbmQiLCJjb21wYXJlVUlEcyIsInVuZGVmaW5lZCIsInVzZXJJRCIsIm9wSUQiLCJjb21wYXJlVmVjdG9ySW5kaWNlcyIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJmaXJzdEluZGV4Iiwic2Vjb25kSW5kZXgiLCJmaWx0ZXJDaGlsZHJlbiIsImRhdGEiLCJwYXJlbnQiLCJmaWx0ZXIiLCJtZXJnZUF0b21zIiwicmVkdWNlIiwicHJldiIsImN1ciIsImNvdW50ZXIiLCJ1aWRDb21wYXJpc29uIiwidWlkIiwic29ydGVkVmVjdG9ySW5kaWNlcyIsImFycmF5SW5kaWNlcyIsImZvckVhY2giLCJkYXR1bSIsImluZGV4IiwicHVzaCIsInNvcnQiLCJ1bmlxdWVJbmRpY2VzIiwibGFzdFZlY3RvckluZGV4IiwidmVjdG9ySW5kZXgiLCJncm91cEJ5U3RyaW5nSW5kZXgiLCJyZXN1bHQiLCJncm91cEJ5VmVjdG9ySW5kZXgiLCJzdHJpbmdJbmRleCIsInRvU3RyaW5nIiwiYXJyYXlNYXAiLCJhIiwiZiIsIm9iamVjdE1hcCIsIm1vZGVsVG9Kc29uIiwibW9kZWwiLCJyb290IiwidXNlZnVsRGF0YSIsImdldFZhbHVlIiwidHlwZU9mVmFsdWUiLCJjaGlsZHJlbiIsImdyb3VwZWQiLCJzb3J0ZWRJbmRpY2VzIiwiYXJyYXlBc09iaiIsImdldEFycmF5IiwianNvbiIsImpzb25FcXVhbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJqc29uQ29weSIsInBhcnNlIiwianNvbkluTGlzdCIsInNlYXJjaEZvciIsImxpc3QiLCJhY2MiLCJlbnRyeSIsInZlY3RvckluZGV4QmV0d2VlbiIsImxlZnQiLCJyaWdodCIsImxlZnRBcnJheSIsInJpZ2h0QXJyYXkiLCJzbGljZSIsImFsbG9jYXRlQmV0d2VlbiIsImxldmVsIiwiY2FycnkiLCJsZWZ0TnVtIiwicmlnaHROdW0iLCJwb3ciLCJtaW4iLCJjb25jYXQiLCJsb3dlckJvdW5kIiwidXBwZXJCb3VuZCIsImZsb29yIiwicmFuZG9tIiwidGhpcyIsIl91aWQiLCJfbW9kZWwiLCJfanNvbiIsIl90b21ic3RvbmVzIiwiX2NvdW50ZXIiLCJfbGlzdGVuZXJzIiwiYWN0aW9ucyIsInRvbWJzdG9uZXMiLCJlbWl0IiwiY29uc29sZSIsImFzc2VydCIsImlzTmFOIiwiX2hpZ2hlc3RDb3VudGVyIiwiaW5kZXhPZiIsIl9lbWl0IiwiX2NoYW5nZWQiLCJkaWZmIiwiX2pzb25EaWZmIiwiYXBwbHkiLCJsaXN0ZW5lciIsIml4Iiwic3BsaWNlIiwiY2hlY2tWYWx1ZSIsIm5ld09wcyIsImpzb25Ub01vZGVsIiwidHlwZU9mTW9kZWwiLCJqc29uQXJyYXlBc09iaiIsIm9jY3VwaWVkU29ydGVkSW5kaWNlcyIsIm1vZGVsSlNPTiIsIm1vZGVsRGF0YSIsIm1hdHJpeCIsImNvc3QiLCJvcGVyYXRpb24iLCJvbGRJbmRleCIsIm5ld0luZGV4IiwiaiIsInN1YnN0aXR1dGlvbkNvc3QiLCJkZWxldGlvbiIsImluc2VydGlvbiIsInN1YnN0aXR1dGlvbiIsImxvd2VzdENvc3RPcCIsIm9wcyIsImxhc3RPbGRJbmRleCIsIm9wIiwibGVmdEluZGV4IiwicmlnaHRJbmRleCIsIm5ld1ZlY3RvckluZGV4IiwiY2hlY2tBcnJheSIsIm1vZGVsS2V5IiwianNvbktleSIsImNoZWNrT2JqZWN0IiwiYWRkVmFsdWUiLCJnZXRVSUQiLCJsZWZ0Qm91bmQiLCJhZGRBcnJheSIsImFkZE9iamVjdCIsIkxvY2FsU3RhdGUiLCJTdGF0ZSIsInN1cGVyIiwiX3BlZXJzIiwicGVlciIsImFkZFBlZXIiLCJlbWl0Q29tcGxldGVTdGF0ZSIsInJlbW92ZVBlZXIiLCJTdGF0ZU92ZXJTaW1wbGVQZWVyIiwibWVzc2FnZSIsInJlY2lwaWVudHMiLCJzZW5kIiwibG9nIiwiX3NlbmRNZXNzYWdlIiwiYWN0aW9uIiwib24iLCJfcmVjZWl2ZWRNZXNzYWdlIiwiX3JlcXVlc3RDb21wbGV0ZVN0YXRlIl0sIm1hcHBpbmdzIjoidUJBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBMERmLE9BckRBRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FD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Q2QsT0FBVSxxQkFDWFQsR0FJUCxpQkFBaUJLLEdBQ1MscUJBQWxCQSxFQUFRSyxPQUNSdkUsS0FBSytELG9CQUNtQixVQUFsQkcsRUFBUUssUUFDZHZFLEtBQUttQixNQUFNK0MsRUFBUXZJLEtBQU11SSxFQUFRMUQsWUFFckNFLFFBQVEyRCxJQUFJLE1BQU9ILEdBQ25CeEQsUUFBUTJELElBQUksZ0JBQWlCckUsS0FBS0UsUUFJdEMsUUFBUTJELEdBQ0E3RCxLQUFLNEQsT0FBTzlDLFFBQVErQyxHQUFRLElBRTVCQSxFQUFLVyxHQUFHLE9BQVF4RSxLQUFLeUUsaUJBQWlCM0ssS0FBS2tHLE9BRTNDQSxLQUFLNEQsT0FBT2xILEtBQUttSCxHQUNqQjdELEtBQUswRSxzQkFBc0JiLElBS25DLFdBQVdBLEdBQ1AsTUFBTXhDLEVBQUtyQixLQUFLNEQsT0FBTzlDLFFBQVErQyxHQUMzQnhDLEdBQU0sR0FDTnJCLEtBQUs0RCxPQUFPdEMsT0FBT0QsRUFBSSxHQUsvQixNQUFNMUYsRUFBb0I2RSxHQUN0QlIsS0FBS3NFLGFBQWEsQ0FDZCxPQUFVLFNBQ1YsS0FBUTNJLEVBQ1IsV0FBYzZFLEtBL0QxQiIsImZpbGUiOiJjcmpzb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMSk7XG4iLCIvLyBBdG9taWMgdHlwZXMgYXJlOiBudW1iZXJzLCBzdHJpbmdzLCBlbXB0eSBsaXN0IFtdLCBlbXB0eSBvYmplY3Qge30sIG51bGwsIHRydWUsIGZhbHNlLlxuZXhwb3J0IHR5cGUgQXRvbWljID0gbnVtYmVyIHwgc3RyaW5nIHwgb2JqZWN0IHwgbnVsbCB8IGJvb2xlYW47XG5cbi8vIEFueSBoYXNoYWJsZSB0eXBlIGNhbiBiZSB1c2VkIGFzIGEgdXNlcklELiBBbGwgYXRvbWljIGl0ZW1zIG11c3QgYmUgaGFzaGFibGUsIHN1Y2ggYXMgc3RyaW5ncyBhbmQgbnVtYmVycy5cbmV4cG9ydCB0eXBlIENvbXBhcmFibGUgPSBBdG9taWM7XG5cbmV4cG9ydCB0eXBlIEpTT05UeXBlID0gYW55O1xuXG4vLyBBIGNvbWJpbmF0aW9uIG9mIGEgdXNlciBJRCArIGFuIG9wIElEIGdpdmVzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIGEgZGF0dW0uXG4vLyB1c2VySUQgaXMgc2V0IG9uIGNvbnN0cnVjdGlvbiAoYW5kIG11c3QgYmUgdW5pcXVlIGluIHRoZSBzeXN0ZW0pIGFuZCBvcElEIGluY3JlbWVudHMgZm9yIGV2ZXJ5IG9wZXJhdGlvbi5cbmV4cG9ydCBpbnRlcmZhY2UgVW5pcXVlSUQge1xuICAgIHVzZXJJRDogQ29tcGFyYWJsZTtcbiAgICBvcElEOiBudW1iZXI7XG59XG5cbi8vIEEgZGF0dW0gaXMgYW4gYXRvbWljIHZhbHVlIGkuZS4gb25lIHdob3NlIG1lcmdlIGZ1bmN0aW9uIHJldHVybnMgb25lIG9mIHRoZSB0d28gYXJndW1lbnRzIHJhdGhlciB0aGFuIGFuIGFtYWxnYW1hdGlvbiBvZiB0aGVtLlxuLy8gSWYgXCJ2YWx1ZVwiIGlzIG1pc3NpbmcsIHRoZW4gdGhpcyBhdG9tIHJlcHJlc2VudHMgYSBkZWxldGlvbi5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0dW0ge1xuICAgIHVpZDogVW5pcXVlSUQ7XG4gICAgcGFyZW50PzogVW5pcXVlSUQ7XG4gICAgdmFsdWU6IGFueTtcbiAgICBjb3VudGVyOiBudW1iZXI7IC8vIExhbXBvcnQgY291bnRlclxuICAgIGluZGV4PzogQXJyYXk8bnVtYmVyPiB8IHN0cmluZzsgLy8gQW4gYXJyYXkgaW5kZXggaXMgZG9uZSB1c2luZyBhIHZlY3RvciwgYW5kIGFuIG9iamVjdCBpbmRleCBpcyBhIHN0cmluZy5cbn1cblxuZXhwb3J0IHR5cGUgTGlzdGVuZXIgPSAobW9kZWw6IEFycmF5PERhdHVtPiwganNvbjogSlNPTlR5cGUpID0+IHZvaWQ7XG5cbi8vIE1vcmUgcHJhY3RpY2FsIHZlcnNpb24gb2YgdHlwZU9mIGZvciBKU09OXG5leHBvcnQgZnVuY3Rpb24gYmV0dGVyVHlwZU9mKGl0ZW06IENvbXBhcmFibGUpOiBzdHJpbmcge1xuICAgIGlmIChpdGVtID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBcIm51bGxcIjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBpdGVtID09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgIHJldHVybiBcImJvb2xlYW5cIjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBpdGVtID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmV0dXJuIFwibnVtYmVyXCI7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgaXRlbSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBcInN0cmluZ1wiO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtKSkge1xuICAgICAgICByZXR1cm4gXCJhcnJheVwiO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGl0ZW0gPT0gXCJvYmplY3RcIikge1xuICAgICAgICByZXR1cm4gXCJvYmplY3RcIjtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLy8gQ29tcGFyZXMgdmFsdWVzLiBSZXR1cm5zIG5lZ2F0aXZlIGlmIGZpcnN0IDwgc2Vjb25kLCBwb3NpdGl2ZSBpZiBmaXJzdCA+IHNlY29uZCwgYW5kIHplcm8gaWYgdGhleSBhcmUgZXF1YWwuXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZShmaXJzdDogQ29tcGFyYWJsZSwgc2Vjb25kOiBDb21wYXJhYmxlKTogbnVtYmVyIHtcbiAgICBjb25zdCB0eXBlT3JkZXJpbmcgPSB7XG4gICAgICAgIFwibnVsbFwiOiAwLFxuICAgICAgICBcImJvb2xlYW5cIjogMSxcbiAgICAgICAgXCJudW1iZXJcIjogMixcbiAgICAgICAgXCJzdHJpbmdcIjogMyxcbiAgICAgICAgXCJhcnJheVwiOiA0LFxuICAgICAgICBcIm9iamVjdFwiOiA1LFxuICAgIH1cbiAgICBjb25zdCB0eXBlT2ZGaXJzdCA9IGJldHRlclR5cGVPZihmaXJzdCk7XG4gICAgY29uc3QgdHlwZU9mU2Vjb25kID0gYmV0dGVyVHlwZU9mKHNlY29uZCk7XG4gICAgaWYgKHR5cGVPZkZpcnN0ICE9IHR5cGVPZlNlY29uZCkge1xuICAgICAgICByZXR1cm4gdHlwZU9yZGVyaW5nW3R5cGVPZkZpcnN0XSAtIHR5cGVPcmRlcmluZ1t0eXBlT2ZTZWNvbmRdO1xuICAgIH1cblxuICAgIGlmICh0eXBlT2ZGaXJzdCA9PSBcImJvb2xlYW5cIiB8fCB0eXBlT2ZGaXJzdCA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHJldHVybiA8bnVtYmVyPmZpcnN0IC0gPG51bWJlcj5zZWNvbmQ7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVPZkZpcnN0ID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgaWYgKDxzdHJpbmc+Zmlyc3QgPiA8c3RyaW5nPnNlY29uZCkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0gZWxzZSBpZiAoPHN0cmluZz5maXJzdCA8IDxzdHJpbmc+c2Vjb25kKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7IC8vIENvbnNpZGVyIGFsbCBhcnJheXMgZXF1YWwgYW5kIGFsbCBvYmplY3RzIGVxdWFsXG59XG5cbi8vIENvbXBhcmUgVUlEcy4gUmV0dXJucyBuZWdhdGl2ZSBpZiBmaXJzdCA8IHNlY29uZCwgcG9zaXRpdmUgaWYgZmlyc3QgPiBzZWNvbmQsIGFuZCB6ZXJvIGlmIHRoZXkgYXJlIGVxdWFsLlxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVVSURzKGZpcnN0OiBVbmlxdWVJRCwgc2Vjb25kOiBVbmlxdWVJRCkge1xuICAgIGlmIChmaXJzdCA9PT0gdW5kZWZpbmVkICYmIHNlY29uZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBpZiAoZmlyc3QgPT09IHVuZGVmaW5lZCAmJiBzZWNvbmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlmIChmaXJzdCAhPT0gdW5kZWZpbmVkICYmIHNlY29uZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBpZiAoZmlyc3QudXNlcklEICE9IHNlY29uZC51c2VySUQpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmUoZmlyc3QudXNlcklELCBzZWNvbmQudXNlcklEKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpcnN0Lm9wSUQgLSBzZWNvbmQub3BJRDtcbn1cblxuLy8gQ29tcGFyZSB2ZWN0b3IgaW5kaWNlcy4gUmV0dXJucyBuZWdhdGl2ZSBpZiBmaXJzdCA8IHNlY29uZCwgcG9zaXRpdmUgaWYgZmlyc3QgPiBzZWNvbmQsIGFuZCB6ZXJvIGlmIHRoZXkgYXJlIGVxdWFsLlxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVWZWN0b3JJbmRpY2VzKGZpcnN0OiBBcnJheTxudW1iZXI+LCBzZWNvbmQ6IEFycmF5PG51bWJlcj4pIHtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgTWF0aC5tYXgoZmlyc3QubGVuZ3RoLCBzZWNvbmQubGVuZ3RoKTsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0SW5kZXggPSBmaXJzdFtpXTtcbiAgICAgICAgY29uc3Qgc2Vjb25kSW5kZXggPSBzZWNvbmRbaV07XG4gICAgICAgIGlmIChmaXJzdEluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2Vjb25kSW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpcnN0SW5kZXggIT0gc2Vjb25kSW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiBmaXJzdEluZGV4IC0gc2Vjb25kSW5kZXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIDA7XG59XG5cbi8vIEZpbHRlcnMgYSBtb2RlbCBvbiBhIGdpdmVuIHBhcmVudFxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlckNoaWxkcmVuKGRhdGE6IEFycmF5PERhdHVtPiwgcGFyZW50OiBVbmlxdWVJRCk6IEFycmF5PERhdHVtPiB7XG4gICAgcmV0dXJuIGRhdGEuZmlsdGVyKGl0ZW0gPT4gY29tcGFyZVVJRHMoaXRlbS5wYXJlbnQsIHBhcmVudCkgPT0gMCk7XG59XG5cbi8vIFJldHVybnMgdGhlIGJlc3QgYXRvbSBjYW5kaWRhdGUgaW4gYSBsaXN0XG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VBdG9tcyhkYXRhOiBBcnJheTxEYXR1bT4pOiBEYXR1bSB7XG4gICAgaWYgKGRhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEucmVkdWNlKChwcmV2LCBjdXIpID0+IHtcbiAgICAgICAgaWYgKGN1ci5jb3VudGVyID4gcHJldi5jb3VudGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VyO1xuICAgICAgICB9IGVsc2UgaWYgKHByZXYuY291bnRlciA+IGN1ci5jb3VudGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1aWRDb21wYXJpc29uID0gY29tcGFyZVVJRHMoY3VyLnVpZCwgcHJldi51aWQpO1xuICAgICAgICBpZiAodWlkQ29tcGFyaXNvbiA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBjdXI7XG4gICAgICAgIH0gZWxzZSBpZiAodWlkQ29tcGFyaXNvbiA8IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwcmV2O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgXCJDb3VsZCBub3QgZmluZCBvcmRlcmluZyBiZXR3ZWVuIG9iamVjdHNcIjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vLyBTb3J0cyB2ZWN0b3IgaW5kaWNlc1xuZXhwb3J0IGZ1bmN0aW9uIHNvcnRlZFZlY3RvckluZGljZXMoZGF0YTogQXJyYXk8RGF0dW0+KTogQXJyYXk8QXJyYXk8bnVtYmVyPj4ge1xuICAgIC8vIEV4dHJhY3QgdmVjdG9yIGluZGljZXMgaW50byBhcnJheVxuICAgIGNvbnN0IGFycmF5SW5kaWNlcyA9IFtdO1xuICAgIGRhdGEuZm9yRWFjaChkYXR1bSA9PiB7XG4gICAgICAgIGlmIChkYXR1bS5pbmRleCAhPT0gdW5kZWZpbmVkICYmIGJldHRlclR5cGVPZihkYXR1bS5pbmRleCkgPT0gXCJhcnJheVwiKSB7XG4gICAgICAgICAgICBhcnJheUluZGljZXMucHVzaChkYXR1bS5pbmRleCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNvcnQgYnkgdmVjdG9yIGluZGV4XG4gICAgYXJyYXlJbmRpY2VzLnNvcnQoY29tcGFyZVZlY3RvckluZGljZXMpO1xuXG4gICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXNcbiAgICBjb25zdCB1bmlxdWVJbmRpY2VzID0gW107XG4gICAgbGV0IGxhc3RWZWN0b3JJbmRleDtcbiAgICBhcnJheUluZGljZXMuZm9yRWFjaCh2ZWN0b3JJbmRleCA9PiB7XG4gICAgICAgIGlmIChsYXN0VmVjdG9ySW5kZXggPT09IHVuZGVmaW5lZCB8fCBjb21wYXJlVmVjdG9ySW5kaWNlcyhsYXN0VmVjdG9ySW5kZXgsIHZlY3RvckluZGV4KSAhPSAwKSB7XG4gICAgICAgICAgICB1bmlxdWVJbmRpY2VzLnB1c2godmVjdG9ySW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIGxhc3RWZWN0b3JJbmRleCA9IHZlY3RvckluZGV4O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHVuaXF1ZUluZGljZXM7XG59XG5cbi8vIEdyb3VwcyBhIGZsYXQgbGlzdCBvZiBEYXR1bXMgYnkgdGhlaXIgc3RyaW5nIGluZGljZXMgKGZvciBkYXR1bXMgaW4gb2JqZWN0cylcbmV4cG9ydCBmdW5jdGlvbiBncm91cEJ5U3RyaW5nSW5kZXgoZGF0YTogQXJyYXk8RGF0dW0+KTogeyBba2V5OiBzdHJpbmddOiBBcnJheTxEYXR1bT47IH0ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuXG4gICAgZGF0YS5mb3JFYWNoKGRhdHVtID0+IHtcbiAgICAgICAgaWYgKGRhdHVtLmluZGV4ICE9PSB1bmRlZmluZWQgJiYgYmV0dGVyVHlwZU9mKGRhdHVtLmluZGV4KSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0WzxzdHJpbmc+ZGF0dW0uaW5kZXhdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbPHN0cmluZz5kYXR1bS5pbmRleF0ucHVzaChkYXR1bSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdFs8c3RyaW5nPmRhdHVtLmluZGV4XSA9IFtkYXR1bV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIEdyb3VwcyBhIGZsYXQgbGlzdCBvZiBEYXR1bXMgYnkgdGhlaXIgdmVjdG9yIGluZGljZXMgKGZvciBkYXR1bXMgaW4gYXJyYXlzKVxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwQnlWZWN0b3JJbmRleChkYXRhOiBBcnJheTxEYXR1bT4pOiB7IFtrZXk6IHN0cmluZ106IEFycmF5PERhdHVtPjsgfSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG5cbiAgICBkYXRhLmZvckVhY2goZGF0dW0gPT4ge1xuICAgICAgICBpZiAoZGF0dW0uaW5kZXggIT09IHVuZGVmaW5lZCAmJiBiZXR0ZXJUeXBlT2YoZGF0dW0uaW5kZXgpID09IFwiYXJyYXlcIikge1xuICAgICAgICAgICAgY29uc3Qgc3RyaW5nSW5kZXggPSBkYXR1bS5pbmRleC50b1N0cmluZygpOyAvLyBTaG91bGQgYmUgc2FmZSwgc2luY2UgdGhlIGtleSBpcyBhIGxpc3Qgb2YgaW50c1xuICAgICAgICAgICAgaWYgKHJlc3VsdFtzdHJpbmdJbmRleF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFtzdHJpbmdJbmRleF0ucHVzaChkYXR1bSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdFtzdHJpbmdJbmRleF0gPSBbZGF0dW1dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyBBcnJheS5tYXAsIGJ1dCByZW1vdmVzIHVuZGVmaW5lZCBlbnRyaWVzLlxuZXhwb3J0IGZ1bmN0aW9uIGFycmF5TWFwKGE6IEFycmF5PGFueT4sIGY6IChpdGVtOiBhbnksIGtleTogYW55LCBhcnI6IEFycmF5PGFueT4pID0+IGFueSk6IEFycmF5PGFueT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGZvciAoY29uc3QgaW5kZXggaW4gYSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGYoYVtpbmRleF0sIGluZGV4LCBhKTtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyBBcnJheS5tYXAsIGJ1dCBmb3Igb2JqZWN0LlxuLy8gSWYgdGhlIGZ1bmN0aW9uIHJldHVybnMgdW5kZWZpbmVkLCB0aGUgdmFsdWUgaXMgb21pdHRlZC5cbmV4cG9ydCBmdW5jdGlvbiBvYmplY3RNYXAobzogb2JqZWN0LCBmOiAoaXRlbTogYW55LCBrZXk6IGFueSwgb2JqOiBvYmplY3QpID0+IGFueSk6IG9iamVjdCB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gbykge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGYob1trZXldLCBrZXksIG8pO1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyBDb252ZXJ0cyBhIChwYXJ0aWFsKSBtb2RlbCBpbnRvIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uLlxuLy8gUmV0dXJucyB1bmRlZmluZWQgaWYgdGhlIG1vZGVsIGlzIHRvdGFsbHkgZW1wdHkuXG5leHBvcnQgZnVuY3Rpb24gbW9kZWxUb0pzb24obW9kZWw6IEFycmF5PERhdHVtPiwgcm9vdDogQXJyYXk8RGF0dW0+KSB7XG4gICAgLy8gS2VlcCB0cmFjayBvZiB3aGljaCBkYXRhIGFyZSBhY3R1YWxseSB1c2VkIHRvIGNvbnN0cnVjdCB0aGUgSlNPTixcbiAgICAvLyBzbyB3ZSBjYW4gcHJ1bmUgdGhlIG90aGVyc1xuICAgIGNvbnN0IHVzZWZ1bERhdGEgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGdldEFycmF5KHBhcmVudDogVW5pcXVlSUQpIHtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBmaWx0ZXJDaGlsZHJlbihtb2RlbCwgcGFyZW50KTtcbiAgICAgICAgY29uc3QgZ3JvdXBlZCA9IGdyb3VwQnlWZWN0b3JJbmRleChjaGlsZHJlbik7XG4gICAgICAgIGNvbnN0IHNvcnRlZEluZGljZXMgPSBzb3J0ZWRWZWN0b3JJbmRpY2VzKGNoaWxkcmVuKTtcbiAgICAgICAgY29uc3QgYXJyYXlBc09iaiA9IG9iamVjdE1hcChncm91cGVkLCBnZXRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBhcnJheU1hcChzb3J0ZWRJbmRpY2VzLCB2ZWN0b3JJbmRleCA9PiBhcnJheUFzT2JqW3ZlY3RvckluZGV4XSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0T2JqZWN0KHBhcmVudDogVW5pcXVlSUQpIHtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBmaWx0ZXJDaGlsZHJlbihtb2RlbCwgcGFyZW50KTtcbiAgICAgICAgY29uc3QgZ3JvdXBlZCA9IGdyb3VwQnlTdHJpbmdJbmRleChjaGlsZHJlbik7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoZ3JvdXBlZCwgZ2V0VmFsdWUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFZhbHVlKGRhdGE6IEFycmF5PERhdHVtPikge1xuICAgICAgICBjb25zdCBkYXR1bSA9IG1lcmdlQXRvbXMoZGF0YSk7XG4gICAgICAgIGlmIChkYXR1bSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHVzZWZ1bERhdGEucHVzaChkYXR1bSk7XG4gICAgICAgIGNvbnN0IHR5cGVPZlZhbHVlID0gYmV0dGVyVHlwZU9mKGRhdHVtLnZhbHVlKTtcbiAgICAgICAgaWYgKHR5cGVPZlZhbHVlID09IFwiYXJyYXlcIikge1xuICAgICAgICAgICAgcmV0dXJuIGdldEFycmF5KGRhdHVtLnVpZCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZU9mVmFsdWUgPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgcmV0dXJuIGdldE9iamVjdChkYXR1bS51aWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDxEYXR1bT5kYXR1bS52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyb290ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcm9vdCA9IGZpbHRlckNoaWxkcmVuKG1vZGVsLCB1bmRlZmluZWQpOyAvLyBQYXJlbnQgPT09IHVuZGVmaW5lZCBpbmRpY2F0ZXMgcm9vdCBpdGVtc1xuICAgIH1cblxuICAgIGxldCByb290SlNPTiA9IGdldFZhbHVlKHJvb3QpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAganNvbjogcm9vdEpTT04sXG4gICAgICAgIHVzZWZ1bERhdGE6IHVzZWZ1bERhdGFcbiAgICB9XG59XG5cbi8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIEpTT04gb2JqZWN0cyBhcmUgZXhhY3RseSBlcXVhbC5cbmV4cG9ydCBmdW5jdGlvbiBqc29uRXF1YWwoZmlyc3Q6IEpTT05UeXBlLCBzZWNvbmQ6IEpTT05UeXBlKTogYm9vbGVhbiB7XG4gICAgLy8gV0FSTklORyEgbnVsbCBlcXVhbHMgdW5kZWZpbmVkIGluIHRoaXMgZnVuY3Rpb24hXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGZpcnN0KSA9PSBKU09OLnN0cmluZ2lmeShzZWNvbmQpO1xufVxuXG4vLyBSZXR1cm5zIGEgZGVlcCBjb3B5IG9mIGEgSlNPTiBvYmplY3RcbmV4cG9ydCBmdW5jdGlvbiBqc29uQ29weShqc29uOiBKU09OVHlwZSk6IEpTT05UeXBlIHtcbiAgICAvLyBXQVJOSU5HISB1bmRlZmluZWQgbWF5IHR1cm4gaW50byBudWxsIGluIHRoaXMgZnVuY3Rpb24hXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoanNvbikpO1xufVxuXG4vLyBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEpTT04gaXMgaW4gdGhlIGxpc3RcbmV4cG9ydCBmdW5jdGlvbiBqc29uSW5MaXN0KHNlYXJjaEZvcjogSlNPTlR5cGUsIGxpc3Q6IEFycmF5PEpTT05UeXBlPikge1xuICAgIHJldHVybiBsaXN0LnJlZHVjZSgoYWNjLCBlbnRyeSkgPT4gKGFjYyB8fCBqc29uRXF1YWwoZW50cnksIHNlYXJjaEZvcikpLCBmYWxzZSk7XG59XG5cbi8vIEFsbG9jYXRlcyBhIG5ldyB2ZWN0b3IgaW5kZXggdGhhdCBmYWxscyBiZXR3ZWVuIHRoZSB0d28gZ2l2ZW4gdmVjdG9yIGluZGljZXMuXG5leHBvcnQgZnVuY3Rpb24gdmVjdG9ySW5kZXhCZXR3ZWVuKGxlZnQ6IEFycmF5PG51bWJlcj4sIHJpZ2h0OiBBcnJheTxudW1iZXI+KSB7XG4gICAgLy8gVXNlcyB0aGUgYWxnb3JpdGhtIGRlc2NyaWJlZCBpbiB0aGlzIHBhcGVyLCBidXQgd2l0aCBvbmx5IHRoZSBib3VuZGFyeSsgc3RyYXRlZ3kgcmlnaHQgbm93LlxuICAgIC8vIEJyaWNlIE7DqWRlbGVjLCBQYXNjYWwgTW9sbGksIEFjaG91ciBNb3N0ZWZhb3VpLCBFbW1hbnVlbCBEZXNtb250aWxzLiBMU0VROiBhbiBBZGFwdGl2ZSBTdHJ1Y3R1cmVcbiAgICAvLyBmb3IgU2VxdWVuY2VzIGluIERpc3RyaWJ1dGVkIENvbGxhYm9yYXRpdmUgRWRpdGluZy4gMTN0aCBBQ00gU3ltcG9zaXVtIG9uIERvY3VtZW50IEVuZ2luZWVyaW5nXG4gICAgLy8gKERvY0VuZyksIFNlcCAyMDEzLCBGbG9yZW5jZSwgSXRhbHkuIHBwLjM34oCTNDYsIGZmMTAuMTE0NS8yNDk0MjY2LjI0OTQyNzhmZi4gZmZoYWwtMDA5MjE2MzNmXG5cbiAgICBmdW5jdGlvbiBhbGxvY2F0ZUJldHdlZW4obGVmdDogQXJyYXk8bnVtYmVyPiwgcmlnaHQ6IEFycmF5PG51bWJlcj4sIGxldmVsOiBudW1iZXIsIGNhcnJ5OiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IGJvdW5kYXJ5ID0gMjA7XG5cbiAgICAgICAgbGV0IGxlZnROdW0gPSAwO1xuICAgICAgICBsZXQgcmlnaHROdW0gPSBNYXRoLnBvdygyLCBsZXZlbCArIDQpO1xuICAgICAgICBpZiAobGVmdCAhPT0gdW5kZWZpbmVkICYmIGxlZnRbbGV2ZWxdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxlZnROdW0gPSBNYXRoLm1heChsZWZ0TnVtLCBsZWZ0W2xldmVsXSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJpZ2h0ICE9PSB1bmRlZmluZWQgJiYgcmlnaHRbbGV2ZWxdICE9PSB1bmRlZmluZWQgJiYgIWNhcnJ5KSB7XG4gICAgICAgICAgICByaWdodE51bSA9IE1hdGgubWluKHJpZ2h0TnVtLCByaWdodFtsZXZlbF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxlZnROdW0gPiByaWdodE51bSkge1xuICAgICAgICAgICAgdGhyb3cgYEJhY2t3YXJkcyBpbnRlcnZhbDogKCR7bGVmdH0gJHtyaWdodH0pYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGVmdE51bSA9PSByaWdodE51bSAmJiAoKGxlZnQgIT09IHVuZGVmaW5lZCAmJiBsZXZlbCArIDEgPj0gbGVmdC5sZW5ndGgpIHx8IChyaWdodCAhPT0gdW5kZWZpbmVkICYmIGxldmVsICsgMSA+PSByaWdodC5sZW5ndGgpKSkge1xuICAgICAgICAgICAgdGhyb3cgYEVtcHR5IGludGVydmFsOiAoJHtsZWZ0fSAke3JpZ2h0fSlgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2UgY2FuIGFsbG9jYXRlIGEgbmV3IG51bWJlciBvbiB0aGUgb3BlbiBpbnRlcnZhbCAobGVmdE51bSwgcmlnaHROdW0pXG4gICAgICAgIGlmIChsZWZ0TnVtICsgMSA+PSByaWdodE51bSkge1xuICAgICAgICAgICAgcmV0dXJuIFtsZWZ0TnVtXS5jb25jYXQoYWxsb2NhdGVCZXR3ZWVuKGxlZnQsIHJpZ2h0LCBsZXZlbCArIDEsIGxlZnROdW0gPCByaWdodE51bSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxvd2VyQm91bmQgPSBsZWZ0TnVtICsgMTtcbiAgICAgICAgY29uc3QgdXBwZXJCb3VuZCA9IE1hdGgubWluKGxvd2VyQm91bmQgKyBib3VuZGFyeSwgcmlnaHROdW0pO1xuICAgICAgICBjb25zdCBuZXdJbmRleCA9IGxvd2VyQm91bmQgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodXBwZXJCb3VuZCAtIGxvd2VyQm91bmQpKTtcbiAgICAgICAgcmV0dXJuIFtuZXdJbmRleF07XG4gICAgfVxuXG4gICAgLy8gTWFrZSBzdXJlIGFycmF5cyBhcmUgc2FtZSBsZW5ndGhcbiAgICBsZXQgbGVmdEFycmF5O1xuICAgIGxldCByaWdodEFycmF5O1xuICAgIGlmIChsZWZ0ICE9PSB1bmRlZmluZWQgJiYgcmlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBsZWZ0QXJyYXkgPSBsZWZ0LnNsaWNlKCk7XG4gICAgICAgIHJpZ2h0QXJyYXkgPSByaWdodC5zbGljZSgpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVmdC5sZW5ndGggLSByaWdodC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcmlnaHRBcnJheS5wdXNoKDApO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmlnaHQubGVuZ3RoIC0gbGVmdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGVmdEFycmF5LnB1c2goMCk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBsZWZ0QXJyYXkgPSBsZWZ0O1xuICAgICAgICByaWdodEFycmF5ID0gcmlnaHQ7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYWxsb2NhdGVCZXR3ZWVuKGxlZnRBcnJheSwgcmlnaHRBcnJheSwgMCwgZmFsc2UpO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBjbGFzcyBTdGF0ZSB7XG4gICAgX3VpZDogVW5pcXVlSUQ7XG4gICAgX21vZGVsOiBBcnJheTxEYXR1bT47XG4gICAgX2pzb246IEpTT05UeXBlO1xuICAgIF90b21ic3RvbmVzOiBBcnJheTxVbmlxdWVJRD47XG4gICAgX2NvdW50ZXI6IG51bWJlcjtcbiAgICBfbGlzdGVuZXJzOiBBcnJheTxMaXN0ZW5lcj47XG5cbiAgICBjb25zdHJ1Y3Rvcih1c2VySUQ6IENvbXBhcmFibGUpIHtcbiAgICAgICAgdGhpcy5fdWlkID0ge1xuICAgICAgICAgICAgdXNlcklEOiB1c2VySUQsXG4gICAgICAgICAgICBvcElEOiAwLFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21vZGVsID0gW107XG4gICAgICAgIHRoaXMuX2pzb24gPSBudWxsO1xuICAgICAgICB0aGlzLl90b21ic3RvbmVzID0gW107XG4gICAgICAgIHRoaXMuX2NvdW50ZXIgPSAwO1xuICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBSZXRyaWV2ZXMgYSBuZXcgVUlEIGZvciBjb25zdHJ1Y3RpbmcgYW4gb3BlcmF0aW9uLlxuICAgIGdldFVJRCgpOiBVbmlxdWVJRCB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgIHVzZXJJRDogdGhpcy5fdWlkLnVzZXJJRCxcbiAgICAgICAgICAgIG9wSUQ6IHRoaXMuX3VpZC5vcElELFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl91aWQub3BJRCsrO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIEFwcGx5IGFuIGFycmF5IG9mIGFjdGlvbnMuXG4gICAgLy8gRm9yIGxvY2FsIGNoYW5nZXMsIHNldCBlbWl0PXRydWUgdG8gYWxzbyBpc3N1ZSBhbiBfZW1pdCBjYWxsLlxuICAgIC8vIEZvciByZW1vdGUgY2hhbmdlcywgc2V0IGVtaXQ9ZmFsc2UgdG8gYXZvaWQgZmxvb2RpbmcgdGhlIGNoYW5uZWwuXG4gICAgLy8gQWxzbyBjb252ZXJ0cyBhIE1vZGVsIGludG8gaXRzIEpTT04gcmVwcmVzZW50YXRpb25cbiAgICAvLyBhbmQsIGluIGRvaW5nIHNvLCBwcnVuZXMgbm9uLXVzZWZ1bCBlbnRyaWVzIGluIHRoZSBtb2RlbC5cbiAgICBhcHBseShhY3Rpb25zOiBBcnJheTxEYXR1bT4sIHRvbWJzdG9uZXM6IEFycmF5PFVuaXF1ZUlEPiwgZW1pdD86IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKGFjdGlvbnMubGVuZ3RoID09IDAgJiYgdG9tYnN0b25lcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gWFhYXG4gICAgICAgIHRoaXMuX21vZGVsLmZvckVhY2goZGF0dW0gPT4ge1xuICAgICAgICAgICAgY29uc29sZS5hc3NlcnQoIWlzTmFOKGRhdHVtLmNvdW50ZXIpLCBcIkNvdW50ZXIgaXMgTkFOXCIpO1xuICAgICAgICAgICAgY29uc29sZS5hc3NlcnQoZGF0dW0uY291bnRlciAhPT0gdW5kZWZpbmVkLCBcIkNvdW50ZXIgaXMgdW5kZWZpbmVkXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gRW5kIFhYWFxuXG4gICAgICAgIC8vIEFwcGx5IGFjdGlvbnNcbiAgICAgICAgdGhpcy5fbW9kZWwucHVzaCguLi5hY3Rpb25zKTtcbiAgICAgICAgdGhpcy5fdG9tYnN0b25lcy5wdXNoKC4uLnRvbWJzdG9uZXMpO1xuICAgICAgICB0aGlzLl9jb3VudGVyID0gTWF0aC5tYXgodGhpcy5fY291bnRlciwgdGhpcy5faGlnaGVzdENvdW50ZXIoYWN0aW9ucykpO1xuXG4gICAgICAgIC8vIEFwcGx5IHRvbWJzdG9uZXNcbiAgICAgICAgdGhpcy5fbW9kZWwgPSB0aGlzLl9tb2RlbC5maWx0ZXIoaXRlbSA9PiAhanNvbkluTGlzdChpdGVtLnVpZCwgdGhpcy5fdG9tYnN0b25lcykpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG1vZGVsVG9Kc29uKHRoaXMuX21vZGVsLCB1bmRlZmluZWQpOyAvLyB1bmRlZmluZWQgcGFyZW50IGluZGljYXRlcyByb290IG9iamVjdFxuICAgICAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2pzb24gPSBudWxsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fanNvbiA9IHJlc3VsdC5qc29uO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJ1bmUgdXNlbGVzcyBkYXRhXG4gICAgICAgIHRoaXMuX21vZGVsID0gdGhpcy5fbW9kZWwuZmlsdGVyKGl0ZW0gPT4gcmVzdWx0LnVzZWZ1bERhdGEuaW5kZXhPZihpdGVtKSA+PSAwKTtcblxuICAgICAgICAvLyBUT0RPIHBydW5lIHRvbWJzdG9uZXMgYWNjb3JkaW5nIHRvIHZlcnNpb24gdmVjdG9yXG5cbiAgICAgICAgaWYgKGVtaXQpIHtcbiAgICAgICAgICAgIHRoaXMuX2VtaXQoYWN0aW9ucywgdG9tYnN0b25lcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jaGFuZ2VkKHRoaXMuX21vZGVsLCB0aGlzLl9qc29uKTtcbiAgICB9XG5cbiAgICAvLyBFbWl0cyB0aGUgY29tcGxldGUgc3RhdGVcbiAgICBlbWl0Q29tcGxldGVTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vZGVsLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZW1pdCh0aGlzLl9tb2RlbCwgdGhpcy5fdG9tYnN0b25lcyk7XG4gICAgfVxuXG4gICAgLy8gR2V0cyB0aGUgY3VycmVudCBzdGF0ZSAoaW50ZXJuYWwgJiBKU09OKVxuICAgIC8vIFRoZSByZXN1bHRpbmcgSlNPTiBpcyBhIGRlZXAgY29weSB0aGF0IGNhbiBiZSBtb2RpZmllZC5cbiAgICBzdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vZGVsOiBqc29uQ29weSh0aGlzLl9tb2RlbCksXG4gICAgICAgICAgICBqc29uOiBqc29uQ29weSh0aGlzLl9qc29uKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSBjdXJyZW50IHN0YXRlIGJhc2VkIG9uIGFuIG9sZCBtb2RlbCBhbmQgbmV3IEpTT05cbiAgICBzZXRTdGF0ZShtb2RlbDogQXJyYXk8RGF0dW0+LCBqc29uOiBKU09OVHlwZSkge1xuICAgICAgICBjb25zdCBkaWZmID0gdGhpcy5fanNvbkRpZmYobW9kZWwsIGpzb24pO1xuICAgICAgICB0aGlzLmFwcGx5KGRpZmYuYWN0aW9ucywgZGlmZi50b21ic3RvbmVzLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvLyBBZGRzIGEgbmV3IGxpc3RlbmVyIGNhbGxiYWNrIGZ1bmN0aW9uLCB3aGljaCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBtb2RlbCBjaGFuZ2VzXG4gICAgYWRkTGlzdGVuZXIobGlzdGVuZXI6IExpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuX2xpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmVzIGEgbGlzdGVuZXJcbiAgICByZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcjogTGlzdGVuZXIpIHtcbiAgICAgICAgY29uc3QgaXggPSB0aGlzLl9saXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICAgIGlmIChpeCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnMuc3BsaWNlKGl4LCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGxzIGFsbCBsaXN0ZW5lcnNcbiAgICBfY2hhbmdlZChtb2RlbDogQXJyYXk8RGF0dW0+LCBqc29uOiBKU09OVHlwZSkge1xuICAgICAgICB0aGlzLl9saXN0ZW5lcnMuZm9yRWFjaChsaXN0ZW5lciA9PiB7XG4gICAgICAgICAgICBsaXN0ZW5lcihtb2RlbCwganNvbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIHNlbmQgb3V0IHN0YXRlIGNoYW5nZXMgb3ZlciBhIGNoYW5uZWxcbiAgICBfZW1pdChtb2RlbDogQXJyYXk8RGF0dW0+LCB0b21ic3RvbmVzOiBBcnJheTxVbmlxdWVJRD4pIHtcbiAgICAgICAgLy8gTm90IGltcGxlbWVudGVkXG4gICAgfVxuXG4gICAgLy8gR2V0cyBhIGNvdW50ZXIgdmFsdWUgb25lIGhpZ2hlciB0aGFuIGFueXRoaW5nIHNlZW4gaW4gdGhlIGdpdmVuIG1vZGVsXG4gICAgX2hpZ2hlc3RDb3VudGVyKG1vZGVsOiBBcnJheTxEYXR1bT4pIHtcbiAgICAgICAgcmV0dXJuIG1vZGVsLnJlZHVjZSgoYWNjLCBkYXR1bSkgPT4gKGRhdHVtLmNvdW50ZXIgPiBhY2MgPyBkYXR1bS5jb3VudGVyIDogYWNjKSwgLTEpO1xuICAgIH1cblxuICAgIC8vIERpZmZzIGEgSlNPTiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gbW9kZWwsIHJldHVybmluZyBhIGxpc3Qgb2YgbmV3IGl0ZW1zIHRvIGFkZCB0byB0aGUgbW9kZWwuXG4gICAgX2pzb25EaWZmKG1vZGVsOiBBcnJheTxEYXR1bT4sIGpzb246IEpTT05UeXBlKToge2FjdGlvbnM6IEFycmF5PERhdHVtPiwgdG9tYnN0b25lczogQXJyYXk8VW5pcXVlSUQ+fSB7XG5cbiAgICAgICAgY29uc3QgY2hlY2tBcnJheSA9IChwYXJlbnQ6IFVuaXF1ZUlELCBqc29uOiBBcnJheTxKU09OVHlwZT4pID0+IHtcbiAgICAgICAgICAgIGludGVyZmFjZSBEaWZmT3BlcmF0aW9uIHtcbiAgICAgICAgICAgICAgICBjb3N0OiBudW1iZXI7XG4gICAgICAgICAgICAgICAgcHJldj86IFtudW1iZXIsIG51bWJlcl07XG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uPzogc3RyaW5nO1xuICAgICAgICAgICAgICAgIG9sZEluZGV4PzogbnVtYmVyO1xuICAgICAgICAgICAgICAgIG5ld0luZGV4PzogbnVtYmVyO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBmaWx0ZXJDaGlsZHJlbihtb2RlbCwgcGFyZW50KTtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwZWQgPSBncm91cEJ5VmVjdG9ySW5kZXgoY2hpbGRyZW4pO1xuICAgICAgICAgICAgY29uc3Qgc29ydGVkSW5kaWNlcyA9IHNvcnRlZFZlY3RvckluZGljZXMoY2hpbGRyZW4pO1xuICAgICAgICAgICAgY29uc3QganNvbkFycmF5QXNPYmogPSBvYmplY3RNYXAoZ3JvdXBlZCwgZGF0YSA9PiBtb2RlbFRvSnNvbihtb2RlbCwgZGF0YSkuanNvbik7XG4gICAgICAgICAgICBjb25zdCBvY2N1cGllZFNvcnRlZEluZGljZXMgPSBhcnJheU1hcChzb3J0ZWRJbmRpY2VzLCB2ZWN0b3JJbmRleCA9PiBqc29uQXJyYXlBc09ialt2ZWN0b3JJbmRleF0gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHZlY3RvckluZGV4KTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsSlNPTiA9IGFycmF5TWFwKG9jY3VwaWVkU29ydGVkSW5kaWNlcywgdmVjdG9ySW5kZXggPT4ganNvbkFycmF5QXNPYmpbdmVjdG9ySW5kZXhdKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsRGF0YSA9IGFycmF5TWFwKG9jY3VwaWVkU29ydGVkSW5kaWNlcywgdmVjdG9ySW5kZXggPT4gZ3JvdXBlZFt2ZWN0b3JJbmRleF0pO1xuXG4gICAgICAgICAgICAvLyBXZSBub3cgaGF2ZSB0d28gSlNPTiBhcnJheXMsIFwibW9kZWxKU09OXCIgYW5kIFwianNvblwiLlxuXG4gICAgICAgICAgICAvLyBQZXJmb3JtIFdhZ25lci1GaXNoZXIgYWxnb3JpdGhtIG9uIHRoZW1cbiAgICAgICAgICAgIC8vIChhbGdvcml0aG0gZnJvbSBwc2V1ZG9jb2RlIG9uIHdpa2lwZWRpYSlcbiAgICAgICAgICAgIGNvbnN0IG1hdHJpeDogeyBba2V5OiBzdHJpbmddOiBEaWZmT3BlcmF0aW9uOyB9ID0ge307XG4gICAgICAgICAgICBtYXRyaXhbWzAsIDBdLnRvU3RyaW5nKCldID0ge2Nvc3Q6IDB9O1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbW9kZWxKU09OLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbWF0cml4W1tpLCAwXS50b1N0cmluZygpXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29zdDogaSxcbiAgICAgICAgICAgICAgICAgICAgcHJldjogW2kgLSAxLCAwXSxcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiBcImRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogaSAtIDEsXG4gICAgICAgICAgICAgICAgICAgIG5ld0luZGV4OiAtMSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBqc29uLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgbWF0cml4W1swLCBqXS50b1N0cmluZygpXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29zdDogaixcbiAgICAgICAgICAgICAgICAgICAgcHJldjogWzAsIGogLSAxXSxcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uOiBcImluc2VydFwiLFxuICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogLTEsIC8vIGluc2VydCBhdCBiZWdpbm5pbmdcbiAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXg6IGogLSAxLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBtb2RlbEpTT04ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBqc29uLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdWJzdGl0dXRpb25Db3N0ID0gMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25FcXVhbChtb2RlbEpTT05baSAtIDFdLCBqc29uW2ogLSAxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnN0aXR1dGlvbkNvc3QgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsZXRpb246IERpZmZPcGVyYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBtYXRyaXhbW2kgLSAxLCBqXS50b1N0cmluZygpXS5jb3N0ICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXY6IFtpIC0gMSwgal0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb246IFwiZGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc2VydGlvbjogRGlmZk9wZXJhdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc3Q6IG1hdHJpeFtbaSwgaiAtIDFdLnRvU3RyaW5nKCldLmNvc3QgKyAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJldjogW2ksIGogLSAxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogXCJpbnNlcnRcIixcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Vic3RpdHV0aW9uOiBEaWZmT3BlcmF0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29zdDogbWF0cml4W1tpIC0gMSwgaiAtIDFdLnRvU3RyaW5nKCldLmNvc3QgKyBzdWJzdGl0dXRpb25Db3N0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJldjogW2kgLSAxLCBqIC0gMV0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnN0aXR1dGlvbkNvc3QgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzdGl0dXRpb24ub3BlcmF0aW9uID0gXCJzdWJzdGl0dXRlXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZXQgbG93ZXN0Q29zdE9wID0gc3Vic3RpdHV0aW9uO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0aW9uLmNvc3QgPCBsb3dlc3RDb3N0T3AuY29zdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXN0Q29zdE9wID0gaW5zZXJ0aW9uO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGlvbi5jb3N0IDwgbG93ZXN0Q29zdE9wLmNvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VzdENvc3RPcCA9IGRlbGV0aW9uO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbG93ZXN0Q29zdE9wLm9sZEluZGV4ID0gaSAtIDE7XG4gICAgICAgICAgICAgICAgICAgIGxvd2VzdENvc3RPcC5uZXdJbmRleCA9IGogLSAxO1xuXG4gICAgICAgICAgICAgICAgICAgIG1hdHJpeFtbaSwgal0udG9TdHJpbmcoKV0gPSBsb3dlc3RDb3N0T3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IG8gPSBtYXRyaXhbW21vZGVsSlNPTi5sZW5ndGgsIGpzb24ubGVuZ3RoXS50b1N0cmluZygpXTtcblxuICAgICAgICAgICAgY29uc3Qgb3BzID0gW107XG4gICAgICAgICAgICB3aGlsZSAoby5jb3N0ID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChvLm9wZXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wc1tvLmNvc3QgLSAxXSA9IG87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8gPSBtYXRyaXhbby5wcmV2LnRvU3RyaW5nKCldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBcHBseSB0aGUgb3BlcmF0aW9ucywgcmVjdXJzaW5nIGFzIG5lZWRlZFxuICAgICAgICAgICAgbGV0IGxhc3RPbGRJbmRleDtcbiAgICAgICAgICAgIGxldCBsYXN0VmVjdG9ySW5kZXg7XG4gICAgICAgICAgICBvcHMuZm9yRWFjaChvcCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9wLm9wZXJhdGlvbiA9PSBcImluc2VydFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBsZWZ0SW5kZXggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcC5vbGRJbmRleCA9PSBsYXN0T2xkSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FzZSBoYW5kbGVzIG11bHRpcGxlIGluc2VydGlvbnMgaW50byB0aGUgc2FtZSBzcG90IChpbmNsdWRpbmcgbXVsdGlwbGUgaW5zZXJ0aW9ucyBpbnRvIGFuIGVtcHR5IGFycmF5KVxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdEluZGV4ID0gbGFzdFZlY3RvckluZGV4O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wLm9sZEluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRJbmRleCA9IG9jY3VwaWVkU29ydGVkSW5kaWNlc1tvcC5vbGRJbmRleF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IHJpZ2h0SW5kZXggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcC5vbGRJbmRleCArIDEgPCBvY2N1cGllZFNvcnRlZEluZGljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodEluZGV4ID0gb2NjdXBpZWRTb3J0ZWRJbmRpY2VzW29wLm9sZEluZGV4ICsgMV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VmVjdG9ySW5kZXggPSB2ZWN0b3JJbmRleEJldHdlZW4obGVmdEluZGV4LCByaWdodEluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgbmV3T3BzLnB1c2goLi4uanNvblRvTW9kZWwoanNvbltvcC5uZXdJbmRleF0sIHBhcmVudCwgbmV3VmVjdG9ySW5kZXgpKTtcbiAgICAgICAgICAgICAgICAgICAgbGFzdE9sZEluZGV4ID0gb3Aub2xkSW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RWZWN0b3JJbmRleCA9IG5ld1ZlY3RvckluZGV4O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3Aub3BlcmF0aW9uID09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tWYWx1ZShwYXJlbnQsIG1vZGVsRGF0YVtvcC5vbGRJbmRleF0sIHVuZGVmaW5lZCk7IC8vIFBhc3NpbmcgSlNPTj11bmRlZmluZWQgZ2VuZXJhdGVzIGEgdG9tYnN0b25lXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcC5vcGVyYXRpb24gPT0gXCJzdWJzdGl0dXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tWYWx1ZShwYXJlbnQsIG1vZGVsRGF0YVtvcC5vbGRJbmRleF0sIGpzb25bb3AubmV3SW5kZXhdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjaGVja09iamVjdCA9IChwYXJlbnQ6IFVuaXF1ZUlELCBqc29uOiBvYmplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gZmlsdGVyQ2hpbGRyZW4obW9kZWwsIHBhcmVudCk7XG4gICAgICAgICAgICBjb25zdCBncm91cGVkID0gZ3JvdXBCeVN0cmluZ0luZGV4KGNoaWxkcmVuKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBtb2RlbEtleSBpbiBncm91cGVkKSB7XG4gICAgICAgICAgICAgICAgY2hlY2tWYWx1ZShwYXJlbnQsIGdyb3VwZWRbbW9kZWxLZXldLCBqc29uW21vZGVsS2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGpzb25LZXkgaW4ganNvbikge1xuICAgICAgICAgICAgICAgIGlmICghKGpzb25LZXkgaW4gZ3JvdXBlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3T3BzLnB1c2goLi4uanNvblRvTW9kZWwoanNvbltqc29uS2V5XSwgcGFyZW50LCBqc29uS2V5KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGNoZWNrVmFsdWUgPSAocGFyZW50OiBVbmlxdWVJRCwgZGF0YTogQXJyYXk8RGF0dW0+LCBqc29uOiBKU09OVHlwZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0dW0gPSBtZXJnZUF0b21zKGRhdGEpO1xuICAgICAgICAgICAgLy8gZGF0dW0gPT09IHVuZGVmaW5lZCBpZiBkYXRhIHdhcyBlbXB0eSwgc3VjaCBhcyBhIHRvdGFsbHkgYmxhbmsgc2xhdGUgbW9kZWwuXG4gICAgICAgICAgICAvLyBQYXNzaW5nIGluIGpzb24gPT09IHVuZGVmaW5lZCBpbmRpY2F0ZXMgdGhhdCBhbnkgdmFsdWUgYXQgdGhpcyBzbG90IHNob3VsZCBiZSBkZWxldGVkLlxuICAgICAgICAgICAgaWYgKGRhdHVtID09PSB1bmRlZmluZWQgJiYganNvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRhdHVtID09PSB1bmRlZmluZWQgJiYganNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbmV3T3BzLnB1c2goLi4uanNvblRvTW9kZWwoanNvbiwgcGFyZW50LCB1bmRlZmluZWQpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoanNvbiA9PT0gdW5kZWZpbmVkICYmIGRhdHVtICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0b21ic3RvbmVzLnB1c2goZGF0dW0udWlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0eXBlT2ZNb2RlbCA9IGJldHRlclR5cGVPZihkYXR1bS52YWx1ZSk7XG4gICAgICAgICAgICBjb25zdCB0eXBlT2ZKc29uID0gYmV0dGVyVHlwZU9mKGpzb24pO1xuICAgICAgICAgICAgaWYgKHR5cGVPZk1vZGVsICE9IHR5cGVPZkpzb24pIHtcbiAgICAgICAgICAgICAgICBuZXdPcHMucHVzaCguLi5qc29uVG9Nb2RlbChqc29uLCBwYXJlbnQsIGRhdHVtLmluZGV4KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZU9mTW9kZWwgPT0gXCJhcnJheVwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrQXJyYXkoZGF0dW0udWlkLCBqc29uKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZU9mTW9kZWwgPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjaGVja09iamVjdChkYXR1bS51aWQsIGpzb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXR1bS52YWx1ZSAhPSBqc29uKSB7XG4gICAgICAgICAgICAgICAgbmV3T3BzLnB1c2goLi4uanNvblRvTW9kZWwoanNvbiwgcGFyZW50LCBkYXR1bS5pbmRleCkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vIENyZWF0ZXMgdGhlIGxpc3Qgb2Ygb3BlcmF0aW9ucyBuZWNlc3NhcnkgdG8gYWRkIHRoZSBnaXZlbiBKU09OIHRvIGEgbW9kZWwuXG4gICAgICAgIC8vIHBhcmVudCAmIGluZGV4IG1heSBiZSB1bmRlZmluZWQgaWYgdGhpcyBpcyB0byBiZSBhIHJvb3Qgb2JqZWN0LlxuICAgICAgICBjb25zdCBqc29uVG9Nb2RlbCA9IChqc29uOiBKU09OVHlwZSwgcGFyZW50OiBVbmlxdWVJRCwgaW5kZXg6IHN0cmluZyB8IEFycmF5PG51bWJlcj4pOiBBcnJheTxEYXR1bT4gPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0YTogQXJyYXk8RGF0dW0+ID0gW107XG5cbiAgICAgICAgICAgIGNvbnN0IGFkZEFycmF5ID0gKGpzb246IEFycmF5PEpTT05UeXBlPiwgcGFyZW50OiBVbmlxdWVJRCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBsZWZ0Qm91bmQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAganNvbi5mb3JFYWNoKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB2ZWN0b3JJbmRleEJldHdlZW4obGVmdEJvdW5kLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICBhZGRWYWx1ZSh2YWx1ZSwgcGFyZW50LCBpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIGxlZnRCb3VuZCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWRkT2JqZWN0ID0gKGpzb246IG9iamVjdCwgcGFyZW50OiBVbmlxdWVJRCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGpzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkVmFsdWUoanNvbltrZXldLCBwYXJlbnQsIGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWRkVmFsdWUgPSAoanNvbjogSlNPTlR5cGUsIHBhcmVudDogVW5pcXVlSUQsIGluZGV4OiBzdHJpbmcgfCBBcnJheTxudW1iZXI+KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZU9mVmFsdWUgPSBiZXR0ZXJUeXBlT2YoanNvbik7XG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlT2ZWYWx1ZSA9PSBcImFycmF5XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBbXTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVPZlZhbHVlID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB7fTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGpzb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdHVtOiBEYXR1bSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdWlkOiB0aGlzLmdldFVJRCgpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ZXI6IHRoaXMuX2NvdW50ZXIrKyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXR1bS5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdHVtLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEucHVzaChkYXR1bSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVPZlZhbHVlID09IFwiYXJyYXlcIikge1xuICAgICAgICAgICAgICAgICAgICBhZGRBcnJheShqc29uLCBkYXR1bS51aWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZU9mVmFsdWUgPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgICAgICBhZGRPYmplY3QoanNvbiwgZGF0dW0udWlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBhZGRWYWx1ZShqc29uLCBwYXJlbnQsIGluZGV4KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWN0dWFsIGNvbnRlbnQgb2YgX2pzb25EaWZmOlxuXG4gICAgICAgIGNvbnN0IG5ld09wczogQXJyYXk8RGF0dW0+ID0gW107XG4gICAgICAgIGNvbnN0IHRvbWJzdG9uZXM6IEFycmF5PFVuaXF1ZUlEPiA9IFtdO1xuXG4gICAgICAgIGNoZWNrVmFsdWUodW5kZWZpbmVkLCBmaWx0ZXJDaGlsZHJlbihtb2RlbCwgdW5kZWZpbmVkKSwganNvbik7IC8vIHVuZGVmaW5lZCBwYXJlbnQgaW5kaWNhdGVzIHJvb3Qgb2JqZWN0XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFjdGlvbnM6IG5ld09wcyxcbiAgICAgICAgICAgIHRvbWJzdG9uZXM6IHRvbWJzdG9uZXMsXG4gICAgICAgIH07XG4gICAgfVxufVxuIiwiZXhwb3J0ICogZnJvbSBcIi4vc3RhdGVcIjtcbmV4cG9ydCAqIGZyb20gXCIuL2xvY2FsXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9wZWVyXCI7XG4iLCJpbXBvcnQge1N0YXRlLCBEYXR1bSwgQ29tcGFyYWJsZSwgVW5pcXVlSUR9IGZyb20gXCIuL3N0YXRlXCI7XG5cbi8vIFRoaXMgY2xhc3MgaXMgbm90IHBhcnRpY3Vhcmx5IHVzZWZ1bCwgYnV0IHNob3dzIHRoZSBzaW1wbGVzdCB3YXkgdGhhdCBTdGF0ZSBjYW4gYmUgZXh0ZW5kZWQuXG5cbmV4cG9ydCBjbGFzcyBMb2NhbFN0YXRlIGV4dGVuZHMgU3RhdGUge1xuICAgIF9wZWVyczogQXJyYXk8TG9jYWxTdGF0ZT47XG5cbiAgICBjb25zdHJ1Y3Rvcih1c2VySUQ6IENvbXBhcmFibGUpIHtcbiAgICAgICAgc3VwZXIodXNlcklEKTtcbiAgICAgICAgdGhpcy5fcGVlcnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBBZGRzIGNvbm5lY3Rpb24gdG8gYSBuZXcgbG9jYWwgU3RhdGUgb2JqZWN0IHRvIGtlZXAgaW4gc3luY1xuICAgIGFkZFBlZXIocGVlcjogTG9jYWxTdGF0ZSkge1xuICAgICAgICBpZiAodGhpcy5fcGVlcnMuaW5kZXhPZihwZWVyKSA8IDAgJiYgcGVlciAhPT0gdGhpcykge1xuICAgICAgICAgICAgdGhpcy5fcGVlcnMucHVzaChwZWVyKTsgLy8gQWRkIHBlZXJcbiAgICAgICAgICAgIHBlZXIuYWRkUGVlcih0aGlzKTsgLy8gTWFrZSBzdXJlIHBlZXIgYWRkcyB1c1xuICAgICAgICAgICAgcGVlci5lbWl0Q29tcGxldGVTdGF0ZSgpOyAvLyBSZXF1ZXN0IHRoYXQgdGhlIHBlZXIgc2VuZCBpdHMgY29tcGxldGUgc3RhdGVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlbW92ZXMgY29ubmVjdGlvbiB0byBhIGxvY2FsIFN0YXRlIG9iamVjdFxuICAgIHJlbW92ZVBlZXIocGVlcjogTG9jYWxTdGF0ZSkge1xuICAgICAgICBjb25zdCBpeCA9IHRoaXMuX3BlZXJzLmluZGV4T2YocGVlcik7XG4gICAgICAgIGlmIChpeCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9wZWVycy5zcGxpY2UoaXgsIDEpO1xuICAgICAgICAgICAgcGVlci5yZW1vdmVQZWVyKHRoaXMpOyAvLyBNYWtlIHN1cmUgcGVlciByZW1vdmVzIHVzIHRvb1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gT3ZlcnJpZGUgZW1pdCBmdW5jdGlvbiB0byBwYXNzIGRhdGEgdG8gcGVlcnNcbiAgICBfZW1pdChkYXRhOiBBcnJheTxEYXR1bT4sIHRvbWJzdG9uZXM6IEFycmF5PFVuaXF1ZUlEPikge1xuICAgICAgICB0aGlzLl9wZWVycy5mb3JFYWNoKHBlZXIgPT4ge1xuICAgICAgICAgICAgcGVlci5hcHBseShkYXRhLCB0b21ic3RvbmVzKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHtTdGF0ZSwgRGF0dW0sIENvbXBhcmFibGUsIEpTT05UeXBlLCBVbmlxdWVJRH0gZnJvbSBcIi4vc3RhdGVcIjtcbmltcG9ydCB7UGVlcn0gZnJvbSBcInNpbXBsZS1wZWVyXCI7XG5cbmV4cG9ydCBjbGFzcyBTdGF0ZU92ZXJTaW1wbGVQZWVyIGV4dGVuZHMgU3RhdGUge1xuICAgIF9wZWVyczogQXJyYXk8UGVlcj47XG5cbiAgICBjb25zdHJ1Y3Rvcih1c2VySUQ6IENvbXBhcmFibGUpIHtcbiAgICAgICAgc3VwZXIodXNlcklEKTtcbiAgICAgICAgdGhpcy5fcGVlcnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBTZW5kcyBhIG5ldHdvcmsgbWVzc2FnZSB0byBhIGdpdmVuIHBlZXIgKG9yIGFsbCBwZWVycyBpZiBvbWl0dGVkKVxuICAgIF9zZW5kTWVzc2FnZShtZXNzYWdlOiBKU09OVHlwZSwgcGVlcj86IFBlZXIpIHtcbiAgICAgICAgbGV0IHJlY2lwaWVudHMgPSB0aGlzLl9wZWVycztcbiAgICAgICAgaWYgKHBlZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVjaXBpZW50cyA9IFtwZWVyXTtcbiAgICAgICAgfVxuICAgICAgICByZWNpcGllbnRzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBwLnNlbmQobWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1vZGVsIGlzOlwiLCB0aGlzLl9tb2RlbCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVFg6XCIsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIC8vIFJlcXVlc3RzIHRoYXQgYSBwZWVyIChvciBhbGwgcGVlcnMpIHNlbmQgdGhlaXIgY29tcGxldGUgc3RhdGVcbiAgICBfcmVxdWVzdENvbXBsZXRlU3RhdGUocGVlcj86IFBlZXIpIHtcbiAgICAgICAgdGhpcy5fc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgXCJhY3Rpb25cIjogXCJzZW5kQ29tcGxldGVTdGF0ZVwiLFxuICAgICAgICB9LCBwZWVyKTtcbiAgICB9XG5cbiAgICAvLyBDYWxsZWQgd2hlbiBhIG1lc3NhZ2UgY29tZXMgaW4gb3ZlciB0aGUgcGVlclxuICAgIF9yZWNlaXZlZE1lc3NhZ2UobWVzc2FnZTogSlNPTlR5cGUpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09IFwic2VuZENvbXBsZXRlU3RhdGVcIikge1xuICAgICAgICAgICAgdGhpcy5lbWl0Q29tcGxldGVTdGF0ZSgpO1xuICAgICAgICB9IGVsc2UgaWYobWVzc2FnZS5hY3Rpb24gPT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgdGhpcy5hcHBseShtZXNzYWdlLmRhdGEsIG1lc3NhZ2UudG9tYnN0b25lcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJSWDpcIiwgbWVzc2FnZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTW9kZWwgaXMgbm93OlwiLCB0aGlzLl9tb2RlbCk7XG4gICAgfVxuXG4gICAgLy8gQWRkcyBuZXcgZGF0YSBjaGFubmVsIHRvIGtlZXAgaW4gc3luY1xuICAgIGFkZFBlZXIocGVlcjogUGVlcikge1xuICAgICAgICBpZiAodGhpcy5fcGVlcnMuaW5kZXhPZihwZWVyKSA8IDApIHtcbiAgICAgICAgICAgIC8vIFNldCB1cCBuZXcgY29ubmVjdGlvblxuICAgICAgICAgICAgcGVlci5vbihcImRhdGFcIiwgdGhpcy5fcmVjZWl2ZWRNZXNzYWdlLmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLl9wZWVycy5wdXNoKHBlZXIpOyAvLyBBZGQgcGVlclxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdENvbXBsZXRlU3RhdGUocGVlcik7IC8vIFJlcXVlc3QgdGhhdCB0aGUgcGVlciBzZW5kIGl0cyBjb21wbGV0ZSBzdGF0ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlcyBhIGRhdGEgY2hhbm5lbFxuICAgIHJlbW92ZVBlZXIocGVlcjogUGVlcikge1xuICAgICAgICBjb25zdCBpeCA9IHRoaXMuX3BlZXJzLmluZGV4T2YocGVlcik7XG4gICAgICAgIGlmIChpeCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9wZWVycy5zcGxpY2UoaXgsIDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2VuZCBtZXNzYWdlcyB0byBwZWVyc1xuICAgIF9lbWl0KGRhdGE6IEFycmF5PERhdHVtPiwgdG9tYnN0b25lczogQXJyYXk8VW5pcXVlSUQ+KSB7XG4gICAgICAgIHRoaXMuX3NlbmRNZXNzYWdlKHtcbiAgICAgICAgICAgIFwiYWN0aW9uXCI6IFwidXBkYXRlXCIsXG4gICAgICAgICAgICBcImRhdGFcIjogZGF0YSxcbiAgICAgICAgICAgIFwidG9tYnN0b25lc1wiOiB0b21ic3RvbmVzLFxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9